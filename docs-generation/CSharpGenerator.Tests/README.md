# CSharpGenerator.Tests

Unit tests for the CSharpGenerator documentation engine.

## Running Tests

```bash
# Run just this project
dotnet test docs-generation/CSharpGenerator.Tests/CSharpGenerator.Tests.csproj

# Run all solution tests
dotnet test docs-generation.sln

# Release mode (matches CI — treats warnings as errors)
dotnet test docs-generation.sln --configuration Release
```

## Test Data Files

Tests use two kinds of data files, served from `TestData/` in the build output:

### Synthetic (committed)

| File | Purpose |
|---|---|
| `cli-output-synthetic.json` | Hand-crafted fixture with 5 tools across 2 service areas. Contains intentional edge cases: tools with empty commands, missing areas, mixed required/optional parameters, and varied metadata annotations. Used by all unit tests via `TestHelpers.LoadCliOutput()`. |

### Sourced from `docs-generation/data/` (not committed to TestData/)

These files are the **real production config** — automatically copied into `TestData/` at build time via `<Content Include>` in the `.csproj`. Tests always run against the latest versions.

| File | Source | Purpose |
|---|---|---|
| `config.json` | `../data/config.json` | Lists required files for `Config.Load()` |
| `nl-parameters.json` | `../data/nl-parameters.json` | Natural language parameter mappings for `TextCleanup` |
| `static-text-replacement.json` | `../data/static-text-replacement.json` | Static text replacements for `TextCleanup` |

### Live CLI output (not committed)

| File | Purpose |
|---|---|
| `cli-output-live.json` | Full 20K+ line output from `azmcp tools list`. Generated by `pretest.sh`. Gitignored. Available for integration tests via `TestHelpers.LoadCliOutput("cli-output-live.json")`. |

To generate the live file:

```bash
bash docs-generation/CSharpGenerator.Tests/pretest.sh
```

The script tries `azmcp` directly, then falls back to `npm run --silent get:tools-json` via `test-npm-azure-mcp/`.

## Test Structure

| File | What it tests |
|---|---|
| `ConfigTests.cs` | `Config.Load()` — file loading, path resolution, error handling |
| `ModelDeserializationTests.cs` | JSON deserialization of all model classes (`CliOutput`, `Tool`, `Option`, `ToolMetadata`, etc.) |
| `DocumentationGeneratorTests.cs` | `TransformCliOutput` — area extraction, tool grouping, command parsing, camelCase conversion |
| `AnnotationGeneratorTests.cs` | `ConvertCamelCaseToTitleCase`, annotation display formatting |
| `ParameterGeneratorTests.cs` | `BuildRequiredText`, common parameter filtering |
| `ParameterSortingTests.cs` | `SortByRequiredThenName` — required-first then alphabetical ordering |
| `FrontmatterUtilityTests.cs` | YAML frontmatter generation (title, description, date) |

## Shared Infrastructure

| File | Purpose |
|---|---|
| `TestHelpers.cs` | Path resolution (`TestDataPath`), fixture loading (`LoadCliOutput`), factory methods (`CreateTool`, `CreateOption`, `CreateCliOutput`), `TempDir` for file-system tests |
| `TextCleanupFixture.cs` | Shared xUnit fixture that initializes `TextCleanup.LoadFiles()` once |
| `StaticStateCollection.cs` | xUnit `[CollectionDefinition("StaticState")]` — serializes test classes that mutate shared static state (`Config`, `TextCleanup`) to prevent parallel race conditions |

Tests that use `Config.Load()` or `TextCleanup` are decorated with `[Collection("StaticState")]` so xUnit runs them sequentially.
